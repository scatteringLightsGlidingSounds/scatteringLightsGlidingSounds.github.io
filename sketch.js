var sitemap,gr,windField,oscilMonitor,lastAngleUpdatedTimer,poleLightJSON,numberOfParticles=800,lightParticles=[],poleLights=[],flowerBedLights=[],dmxAddressBook=[];function preload(){sitemap=loadImage("./data/images/sitemap.png"),poleLightJSON=loadJSON("./data/json/pole.json"),flowerBedsJSON=loadJSON("./data/json/flowerPot.json"),dmxAddressJSON=loadJSON("./data/json/dmxAddresses.json")}function setup(){createCanvas(1920,840).parent("p5Container"),windField=new WindField(50),(oscilMonitor=new OscilMonitor).setup(),windField.setAngle(random(180,360)),lastAngleUpdatedTimer=millis(),oscilMonitor.setFreq(random(20,300)),oscilMonitor.setParamA(random(2,4)),oscilMonitor.setParamB(random(1,5));for(var e=0;e<poleLightJSON.poles.length;e++)s=createVector(poleLightJSON.poles[e].x,poleLightJSON.poles[e].y),poleLights.push(new Light(poleLightJSON.poles[e].ID,s,1,1,255)),poleLights[e].setColor(74,205,240,100);for(e=0;e<flowerBedsJSON.flowerBeds.length;e++)s=createVector(flowerBedsJSON.flowerBeds[e].x,flowerBedsJSON.flowerBeds[e].y),flowerBedLights.push(new Light(flowerBedsJSON.flowerBeds[e].ID,s,2,1,100)),flowerBedLights[e].setColor(71,200,242,100);var o;for(e=0;e<dmxAddressJSON.root.flowerPot.length;e++){o=[];for(var t=0;t<dmxAddressJSON.root.flowerPot[e].addr.length;t++)o.push(dmxAddressJSON.root.flowerPot[e].addr[t]);dmxAddressBook.push(o)}var s;for(e=0;e<numberOfParticles;e++)s=createVector(random(width),random(height)),lightParticles.push(new LightParticle(s,random(.3,.7),random(.3,.5)));gr=createVector(0,2)}function draw(){image(sitemap,0,0),windField.update(),oscilMonitor.updateBuffer(),millis()-lastAngleUpdatedTimer>3e4&&(windField.setAngle(random(180,270)),this.oscilMonitor.setFreq(random(20,100)),lastAngleUpdatedTimer=millis());for(var e=0;e<poleLights.length;e++){for(var o=0;o<lightParticles.length;o++)10>dist(poleLights[e].pos.x,poleLights[e].pos.y,lightParticles[o].pos.x,lightParticles[o].pos.y)&&(poleLights[e].isOn=!0);poleLights[e].update(!1),poleLights[e].draw()}for(e=0;e<flowerBedLights.length;e++)flowerBedLights[e].draw();for(e=0;e<this.dmxAddressBook.length;e++)for(o=0;o<this.dmxAddressBook[e].length;o++)for(var t=0;t<this.flowerBedLights.length;t++)this.dmxAddressBook[e][o]==this.flowerBedLights[t].ID&&this.flowerBedLights[t].setAlpha(map(this.oscilMonitor.getFlowerBedValue(int(map(t,0,this.flowerBedLights.length,1,width))),0,1,0,140));for(e=0;e<lightParticles.length;e++)lightParticles[e].follow(windField),lightParticles[e].run(!1),lightParticles[e].draw(!1)}